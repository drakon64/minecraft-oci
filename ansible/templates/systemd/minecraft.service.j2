[Unit]
Description=Minecraft Server
After=network.target

[Service]
Type=forking
{% if random_server_icon %}
ExecStartPre=-/opt/minecraft/server-icon.sh
{% endif %}
{% if ansible_memtotal_mb < (12288 + heap) %}
ExecStart=/usr/bin/tmux new-session -s minecraft -d '{{ command }}'
{% else %}
ExecStart=/usr/bin/tmux new-session -s minecraft -d '{{ high_ram_command }}'
{% endif %}
ExecStop=/usr/bin/tmux send-keys -t minecraft stop ENTER

WorkingDirectory=/opt/minecraft/server

User=minecraft
Group=minecraft

Nice=-20
OOMScoreAdjust=-1000

[Install]
WantedBy=multi-user.target
