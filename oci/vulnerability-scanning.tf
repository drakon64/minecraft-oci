resource "oci_identity_policy" "minecraft_vulnerability_scan" {
  compartment_id = oci_identity_compartment.minecraft_compartment.id
  description    = "Minecraft vulnerability scanning"
  name           = "minecraft-vulnerability-scanning"
  statements = [
    "allow service vulnerability-scanning-service to manage instances in compartment id ${oci_identity_compartment.minecraft_compartment.id}",
    "allow service vulnerability-scanning-service to read compartments in compartment id ${oci_identity_compartment.minecraft_compartment.id}",
    "allow service vulnerability-scanning-service to read vnics in compartment id ${oci_identity_compartment.minecraft_compartment.id}",
    "allow service vulnerability-scanning-service to read vnic-attachments in compartment id ${oci_identity_compartment.minecraft_compartment.id}"
  ]
}

resource "oci_vulnerability_scanning_host_scan_recipe" "minecraft_vulnerability_scan" {
  agent_settings {
    agent_configuration {
      cis_benchmark_settings {
        scan_level = "STRICT"
      }
      vendor = "OCI"
    }
    scan_level = "STANDARD"
  }
  compartment_id = oci_identity_compartment.minecraft_compartment.id
  display_name   = "minecraft-vulnerability-scan"
  port_settings {
    scan_level = "STANDARD"
  }
  schedule {
    day_of_week = "WEDNESDAY"
    type        = "WEEKLY"
  }
}

resource "oci_vulnerability_scanning_host_scan_target" "minecraft_vulnerability_scan" {
  compartment_id        = oci_identity_compartment.minecraft_compartment.id
  display_name          = "minecraft-vulnerability-scan"
  host_scan_recipe_id   = oci_vulnerability_scanning_host_scan_recipe.minecraft_vulnerability_scan.id
  target_compartment_id = oci_identity_compartment.minecraft_compartment.id
}
